import cv2 as cv
import matplotlib.pyplot as plt
import numpy as np
from matplotlib import patches


def XYZtoxyY(X, Y, Z):
    a = X / (X + Y + Z)
    b = Y / (X + Y + Z)
    return a, b


######### BLACK ###########

color1 = [[[0.39412754296211777, 0.3028698921000988, 0.7019514859809306],
           [0.39472936197803293, 0.30257578085699854, 0.7017514945012077]],
          [[0.4040059314005252, 0.29090650422926445, 0.7025263135280517],
           [0.4037800639591041, 0.29141922509688595, 0.702383871754652]],
          [[0.3924774674522168, 0.28752844333590344, 0.6845635500676548],
           [0.39322469167278773, 0.28876726139995845, 0.6860968753402025]],
          [[0.41075952806115423, 0.3104875358419309, 0.6944600445814619],
           [0.4095092935103916, 0.3092689062154808, 0.6951037757595]],
          [[0.39346331996154293, 0.3027753862061111, 0.709414234201485],
           [0.3938699754205794, 0.30260272578139863, 0.708828562314815]],
          [[0.4092167043220926, 0.2954957615266848, 0.6969371816330167],
           [0.40673838626846337, 0.29670692498990997, 0.6977607556339409]],
          [[0.39673718699862853, 0.30740661116283274, 0.6979423290614045],
           [0.3978092766232788, 0.3049729592869348, 0.6986184351279445]],
          [[0.41260500375523035, 0.3208977518656041, 0.7258658248573447],
           [0.41171260761873396, 0.3194182542479547, 0.7240346027000004]],
          [[0.39221947032305676, 0.292416155858104, 0.7040061039199756],
           [0.39373737421942584, 0.29389568836429736, 0.7032245529199954]],
          [[0.4101273853073566, 0.2957000487524789, 0.6854143729582582],
           [0.40934490726878225, 0.2960322783770081, 0.6865413107109581]],
          [[0.40449110537002875, 0.28980515550442787, 0.7028322852085589],
           [0.40335446852106815, 0.2923853300869307, 0.7021154728718237]],
          [[0.4211879907456365, 0.32065237537375096, 0.6890905508613331],
           [0.420084470285144, 0.31957675102332034, 0.6896587406666689]],
          [[0.40994411894198507, 0.29514027123400854, 0.6966954532689118],
           [0.40750356632774787, 0.29633297858329904, 0.6975064773737599]],
          [[0.4216968232335899, 0.335971018891549, 0.7445224960355872],
           [0.4207271226537488, 0.33436335875157935, 0.7425326429701465]],
          [[0.4064188100685574, 0.29727465979379253, 0.690755524069599],
           [0.40499013141191553, 0.2978812574876189, 0.6928131305905177]]]
color1T = [0.4, 0.3, 0.7]
target = XYZtoxyY(0.4, 0.3, 0.7)

color2 = [[0.20487733868150168, 0.1979291477600964, 0.4929755765377102],
          [0.2042586421938985, 0.19819183794645415, 0.4938666334044476]], [
    [0.2049943031432242, 0.20828002195440826, 0.5102484515590501],
    [0.20470408954737424, 0.20779887876461894, 0.5096529250374208]], [
    [0.21215896372754067, 0.19405786815945092, 0.4959594345086097],
    [0.20948839188324667, 0.19536298678173203, 0.49684689668697707]], [
    [0.21171564585891928, 0.21141948375044298, 0.49396775068675003],
    [0.21017171591746725, 0.20991458311666264, 0.49476270219357965]], [
    [0.20439051180205367, 0.19003350369452027, 0.5027688465556711],
    [0.2035465421441024, 0.1919493214527083, 0.5022366028023537]], [
    [0.20983067298024027, 0.1958260288058114, 0.48584170293639817],
    [0.20825373351985568, 0.19649557603781218, 0.4881128371076109]], [
    [0.19488121002828696, 0.19501060892350158, 0.5026356052123262],
    [0.19624606055542068, 0.19634095712658603, 0.5019328596057984]], [
    [0.22043523242658497, 0.2338794358858893, 0.5419336759535553],
    [0.21995995455346276, 0.23309147586202983, 0.5409583922913312]], [
    [0.1982239165059949, 0.2040317234935904, 0.4988799249639506],
    [0.1984687383691135, 0.20347597593971056, 0.49903432021512195]], [
    [0.20586951526118796, 0.19713154555736573, 0.4980494916057833],
    [0.20388838909803336, 0.1980997294518173, 0.4987078429413335]], [
    [0.1971708941870684, 0.20120120018153628, 0.5040745247659403],
    [0.19817434826734898, 0.20077514710925926, 0.5026293336801568]], [
    [0.204683104776814, 0.20456471965305573, 0.49758872400941456],
    [0.20283357521639211, 0.2027619447129851, 0.49854102519323673]], [
    [0.19571561965406353, 0.19289695432814924, 0.4912083301360177],
    [0.19645003837712882, 0.19411454224308372, 0.49271537816485145]], [
    [0.20522652613574172, 0.18813574458494842, 0.5032960733375786],
    [0.20400666530736195, 0.19090483825497567, 0.5025267763614316]], [
    [0.1943814966768133, 0.2027457839533905, 0.5018670941989496],
    [0.1960623938116391, 0.20192432312750508, 0.5013085124719419]]
color2T = [0.2, 0.2, 0.5]
target2 = XYZtoxyY(0.2, 0.2, 0.5)

color3 = [[0.10241307872930162, 0.44769109975962207, 0.13242927237329244],
          [0.10441062587506514, 0.4467148908684849, 0.13176546415365648]], [
    [0.22302053914398567, 0.34774319517342683, 0.11451774722224896],
    [0.22204623848584915, 0.34995486532659714, 0.11390331110566514]], [
    [0.1870181398938439, 0.3784774604973945, 0.07336085523266483],
    [0.18714523903265257, 0.37868817731404386, 0.07362166626674171]], [
    [0.28575124559345905, 0.48358352304489016, 0.05584768449212943],
    [0.28501710262257984, 0.48286793861809785, 0.05622568613926372]], [
    [0.1260972155048311, 0.43137812581836354, 0.20643600685457592],
    [0.12695521989233752, 0.4310138287244476, 0.20520029481079144]], [
    [0.2416655828945098, 0.3796378710949096, 0.08615404073943499],
    [0.23956468352510085, 0.3806645886110149, 0.08685219410868059]], [
    [0.16986953727523457, 0.4683963872476795, 0.08099842758713921],
    [0.1703881806063669, 0.4672190628088353, 0.08132550649405747]], [
    [0.261127232969775, 0.5013424328654628, 0.22543481403995966],
    [0.26013173746223944, 0.49969200748648024, 0.22339202905201355]], [
    [0.17829041670397613, 0.37883921751619914, 0.11117801105507856],
    [0.18016978045383453, 0.38067107246138254, 0.11021034859532611]], [
    [0.24270417619475051, 0.3818683825952994, 0.038496742426794385],
    [0.24125769463410598, 0.38248253916211744, 0.040579988983138165]], [
    [0.22028231741648163, 0.35395898002064863, 0.11279090622040568],
    [0.21943888550571633, 0.35587357708849715, 0.112259001593712]], [
    [0.30042075005199087, 0.497882194224313, 0.048294527861987],
    [0.2984588170076362, 0.4959698572700162, 0.049304704287765615]], [
    [0.22458907011052637, 0.38798322787144257, 0.09182876514970378],
    [0.22314892813194076, 0.3886870307363596, 0.09230734112967773]], [
    [0.2415134080435412, 0.4688248030096399, 0.18518668955097825],
    [0.2408142944611677, 0.46766574725257576, 0.18375208867118395]], [
    [0.2152369354170724, 0.3935306026712102, 0.078055514774274],
    [0.21352461789337948, 0.3942576296035031, 0.0805216226609248]]
color3T = [0.2, 0.4, 0.1]
target3 = XYZtoxyY(0.2, 0.4, 0.1)

'''
############# GREY ##################

color1 = [[0.3952930259486028, 0.30230031612974495, 0.701564182388164],
          [0.3971009572612979, 0.30141677321774846, 0.7009633857218878]], [
    [0.40483698255249007, 0.28902001158122104, 0.7030504103129933],
    [0.4037274784817245, 0.2915385945439242, 0.7023507090792088]], [
    [0.3956278260107426, 0.29275140183097226, 0.6910281750923679],
    [0.39655723735028137, 0.2942922667074861, 0.6929353534951482]], [
    [0.4197028385242428, 0.3192047666065203, 0.6898552384061305],
    [0.4182810042258741, 0.3178188751361255, 0.6905873242913794]], [
    [0.39874749147902433, 0.30053179822963655, 0.7018038833913315], [0.4, 0.3, 0.7]], [
    [0.4054672535853191, 0.29732813236903616, 0.6981831678534016],
    [0.40471585479544864, 0.29769534381684454, 0.6984328664369863]], [
    [0.3974864656473746, 0.30570574273992845, 0.6984148565705773],
    [0.39780002435463535, 0.30499396200948986, 0.6986126002473381]], [
    [0.4090277764783975, 0.31496709056238126, 0.7185252531277185],
    [0.4079925192519606, 0.3132507444941641, 0.7164008759659739]], [
    [0.38944836674004274, 0.2897151035458294, 0.7054329128118519],
    [0.3904715908776442, 0.2907124613998572, 0.7049060666459918]], [
    [0.4094325524174661, 0.2959950654286523, 0.6864150827249655],
    [0.4080264529639642, 0.29659207629727524, 0.6884401703058121]], [
    [0.41343352347194, 0.26950579611469433, 0.708471760667722],
    [0.4122419110046291, 0.2722107657830284, 0.7077202783293155]], [
    [0.40774588803152256, 0.3075500782094212, 0.6960117326589305],
    [0.4064865299813406, 0.30632255571828226, 0.6966601614203344]], [
    [0.4069753161081867, 0.29659113647567936, 0.6976820210842114],
    [0.4047880471176868, 0.2976600631542627, 0.6984088760861211]], [
    [0.40649442875455566, 0.31076707022520583, 0.713326751818232],
    [0.4055009152300792, 0.3091199307627509, 0.7112880339156809]], [
    [0.4044722486068636, 0.29810114354370043, 0.6935589939319995],
    [0.40336903001540436, 0.2985695552822355, 0.6951478675091558]]
color1T = [0.4, 0.3, 0.7]
target = XYZtoxyY(0.4, 0.3, 0.7)

color2 = [[0.20682390597794179, 0.19710266153283387, 0.4901720982720119],
          [0.20635423933030433, 0.19730207565860639, 0.49084851990982686]], [
    [0.2024666466964496, 0.20408943714761893, 0.505061628911363],
    [0.2021265362546632, 0.2035255703089118, 0.5043637126480893]], [
    [0.20640158066491127, 0.19687152316996787, 0.4978726800651273],
    [0.20381933338062524, 0.19813347724368324, 0.4987307909618223]], [
    [0.20814244188692876, 0.20793660750217374, 0.49580755170717195],
    [0.20690692930571133, 0.20673232768571453, 0.4964437027149191]], [
    [0.21192146081675256, 0.17293819022864032, 0.5075181885869418],
    [0.2108395324943253, 0.1753941760258363, 0.506835877812231]], [
    [0.20943340898300428, 0.1959947017424744, 0.48641384908517626],
    [0.20820363721786356, 0.19651684625215765, 0.4881849866264504]], [
    [0.18949654901152002, 0.1897620678082202, 0.5054081043226292],
    [0.19142590000688392, 0.19164264636153022, 0.5044147040135936]], [
    [0.2100585524937845, 0.21667600726061195, 0.5206404347174178],
    [0.20942416563177724, 0.2156242615026207, 0.5193386549017893]], [
    [0.19761059039414308, 0.20542397858899103, 0.49849313500212666],
    [0.1984244835909682, 0.20357643463399722, 0.49900641123877393]], [
    [0.2057542907169802, 0.19718785623056878, 0.49808778206601656],
    [0.20448934068136604, 0.19780604212632086, 0.49850813971957697]], [
    [0.1983955116462668, 0.20068124412065735, 0.5023108105409371], [0.2, 0.2, 0.5]], [
    [0.21744781305455202, 0.21700674636776732, 0.49101632470087775],
    [0.2167302992421975, 0.2163073707277412, 0.49138576418837543]], [
    [0.19371887607259064, 0.18958656642861815, 0.4871109557308752],
    [0.1941951380993145, 0.19037615807418629, 0.48808825890417507]], [
    [0.20366443809199214, 0.1916816967241915, 0.5023109530840427],
    [0.20288720109113983, 0.19344603082616418, 0.5018207938293191]], [
    [0.19335302400565468, 0.20324840246129702, 0.5022088676655904],
    [0.1942877516878792, 0.20279159748619802, 0.501898246752388]]
color2T = [0.2, 0.2, 0.5]
target2 = XYZtoxyY(0.2, 0.2, 0.5)

color3 = [[0.18960147642471012, 0.40508179803937355, 0.10345555069175477],
          [0.19065852028659142, 0.40456521668184264, 0.1031042826851294]], [
    [0.20911134369163317, 0.3793171781936351, 0.10574600723913637],
    [0.2087912370679884, 0.38004382274574017, 0.10554413416322031]], [
    [0.19555651266433005, 0.3926331719083975, 0.09088183808492893],
    [0.19605860604596198, 0.39346558918541363, 0.09191214793040871]], [
    [0.26632377681708186, 0.4646471650603937, 0.06585066141680912],
    [0.26562626760682234, 0.4639672883222044, 0.06620980076817234]], [
    [0.18951611859795636, 0.4044513146824614, 0.11509905858612708],
    [0.19067383822653472, 0.4039597625384377, 0.11343169171808845]], [
    [0.2149325326252964, 0.39270241448522214, 0.09503774520782823],
    [0.21325940505808602, 0.39352007829384933, 0.09559374501687867]], [
    [0.19300758640710175, 0.4158728338248423, 0.09559028168801005],
    [0.19319772144197855, 0.415441225800977, 0.09571018906103768]], [
    [0.22209552831194682, 0.4366320293884005, 0.1453406501533307],
    [0.2213506792567444, 0.4353971490952081, 0.14381219878741738]], [
    [0.14305541876640548, 0.34449493199918235, 0.12932010024681223],
    [0.14473340118946465, 0.3461304963756068, 0.1284561266818006]], [
    [0.23599038179932405, 0.38471896916923404, 0.04816605964093184],
    [0.23489968428807073, 0.38518206462594334, 0.0497369001522473]], [
    [0.21302956971863396, 0.3704227743102718, 0.10821700996691114],
    [0.2128478170804496, 0.3708353542277494, 0.10810238889563067]], [
    [0.2578547235592382, 0.45639220266018155, 0.07021127809246701],
    [0.25655367709750654, 0.45512404560702135, 0.07088117173041035]], [
    [0.21809845525569158, 0.3911552160488804, 0.09398567218454819],
    [0.216694705839794, 0.39184123372993196, 0.09445215449139048]], [
    [0.23506845459276315, 0.45813975756141134, 0.17196146245793664],
    [0.23420202229695278, 0.4567033052224997, 0.17018351883734234]], [
    [0.22831260975372036, 0.3879788476555096, 0.059223713336337004],
    [0.22732113741213775, 0.3883998134430929, 0.06065164812479833]]
color3T = [0.2, 0.4, 0.1]
target3 = XYZtoxyY(0.2, 0.4, 0.1)
'''


# Finds the midpoint of two 3D points
def findmid(a1, b1):
    x1 = (a1[0] + b1[0]) / 2
    y1 = (a1[1] + b1[1]) / 2
    z1 = (a1[2] + b1[2]) / 2
    return x1, y1, z1


##################### COLOR 1 ########################
col1mids = []  # List of midpoints
for i in range(len(color1)):  # For loop that finds the mid points of all data points
    if i % 2 == 0:
        p = findmid(color1[i][0], color1[i][1])
        col1mids.append(p)

Elist = []  # Empty list
for i in col1mids:  # For loop that converts tuple to floats and appends to a list
    smollist = []
    for j in i:
        h = float(j)
        smollist.append(h)
    x = smollist
    Elist.append(x)
    smollist = []

col1XYZ = []
for sublist in Elist:  # For loop that inputs all xyY data points into a list
    x1 = sublist[0]
    y1 = sublist[1]
    z1 = sublist[2]
    col1 = XYZtoxyY(x1, y1, z1)  # Converts all XYZ values to xyY values
    col1XYZ.append(col1)

col1np = np.array(col1XYZ, dtype=np.float32)  # Convert to numpy array
ellipse1 = cv.fitEllipse(col1np)  # Uses CV2 function to fit data to an ellipse
(x, y), (minor, major), angles = ellipse1  # Takes the ellipse data and puts into variables

# Creates a figure to plot the ellipses onto
fig = plt.figure(figsize=(5, 5))
ax = fig.add_subplot(211, aspect='auto')
ax.fill(x, y, alpha=0.2, facecolor='yellow',
        edgecolor='yellow', linewidth=1, zorder=1)
# Makes the ellipse a patch and plots it on the figure
e1 = patches.Ellipse((x, y), major, minor, angle=angles)
ax.add_patch(e1)

############### Color 2 #####################
col2mids = []
for i in range(len(color2)):
    if i % 2 == 0:
        p = findmid(color2[i][0], color2[i][1])
        col2mids.append(p)
Flist = []  # Empty list

for i in col2mids:  # For loop that converts tuple to floats and appends to a list
    smollist = []
    for j in i:
        h = float(j)
        smollist.append(h)
    x = smollist
    Flist.append(x)
    smollist = []

col2XYZ = []
for sublist in Flist:
    x1 = sublist[0]
    y1 = sublist[1]
    z1 = sublist[2]
    col2 = XYZtoxyY(x1, y1, z1)
    col2XYZ.append(col2)

col2np = np.array(col2XYZ, dtype=np.float32)
ellipse2 = cv.fitEllipse(col2np)
(x2, y2), (minor2, major2), angles2 = ellipse2

e2 = patches.Ellipse((x2, y2), major2, minor2, angle=angles2)
ax.add_patch(e2)

################## Color 3 #####################
col3mids = []
for i in range(len(color3)):
    if i % 2 == 0:
        p = findmid(color3[i][0], color3[i][1])
        col3mids.append(p)

Glist = []  # Empty list
for i in col3mids:  # For loop that converts tuple to floats and appends to a list
    smollist = []
    for j in i:
        h = float(j)
        smollist.append(h)
    x = smollist
    Glist.append(x)
    smollist = []

col3XYZ = []
for sublist in Glist:
    x1 = sublist[0]
    y1 = sublist[1]
    z1 = sublist[2]
    col3 = XYZtoxyY(x1, y1, z1)
    col3XYZ.append(col3)

col3np = np.array(col3XYZ, dtype=np.float32)
ellipse3 = cv.fitEllipse(col3np)
(x3, y3), (minor3, major3), angles3 = ellipse3

e3 = patches.Ellipse((x3, y3), major3, minor3, angle=angles3)
ax.add_patch(e3)

ax.set_xlim(0, 1)
ax.set_ylim(0, 1)
ax.set_box_aspect(1)
fig.savefig('arc_compare')

plt.show()
